@model purchaseTracking.Models.Activities.details
@using purchaseTracking.Models.Activities
@{
    ViewBag.Title = "Detalles Solicitud";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .modal-backdrop.fade.show {
        display: none;
    }

    .center-all {
        text-align: center;
    }

        .center-all .form-control,
        .center-all textarea,
        .center-all .form-select {
            text-align: center;
        }

    .center-buttons {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
    }

    .white-card {
        background: #ffffff;
        border-radius: 12px;
        padding: 25px 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-top: 20px;
    }

    .card-title-center {
        text-align: center;
        color: #198754;
        font-weight: 600;
        margin-bottom: 20px;
    }
    body {
        background-color: #f4f5f7 !important; 
    }
</style>

<div class="container-fluid center-all">
    <div class="row justify-content-md-center">
        <div class="col-md-10">

            <div class="white-card">

                <span class="badge bg-success" style="margin-top:15px;">@Model.Name</span>
                <h4 style="margin-top:15px;">@Model.Name</h4>

                <fieldset disabled>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Número de Actividad</label>
                            <input type="text" class="form-control" value="@Model.ClgCode">
                        </div>
                    </div>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Tipo de Solicitud</label>
                            <input type="text" class="form-control" value="@Model.observaciones">
                        </div>
                    </div>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Fecha Inicio</label>
                            <input type="text" class="form-control" value="@Model.Recontact.ToString("dd/MM/yyyy")">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Fecha Fin</label>
                            <input type="text" class="form-control" value="@Convert.ToDateTime(Model.FechaActualizacion).ToString("dd/MM/yyyy")">
                        </div>
                    </div>

                    @{
                        int cantidad = 0;
                        TimeSpan diferencia = Convert.ToDateTime(Model.FechaActualizacion) - Model.Recontact;
                        for (int i = 0; i <= diferencia.Days; i++)
                        {
                            DateTime fechaActual = Model.Recontact.AddDays(i);
                            if (fechaActual.DayOfWeek != DayOfWeek.Saturday && fechaActual.DayOfWeek != DayOfWeek.Sunday &&
                                !(fechaActual.Month == 12 && fechaActual.Day == 25) &&
                                !(fechaActual.Month == 11 && fechaActual.Day == 1) &&
                                !(fechaActual.Month == 9 && fechaActual.Day == 15) &&
                                !(fechaActual.Month == 3 && (fechaActual.Day == 28 || fechaActual.Day == 29)))
                            {
                                cantidad++;
                            }
                        }
                    }

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Días a Tomar</label>
                            <input type="text" class="form-control" value="@cantidad">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Aplica Medio Día</label>
                            <input type="text" class="form-control" value="@(Model.U_retrasoDias == "1" ? "Sí" : "No")" readonly>
                        </div>
                    </div>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Estado</label>
                            <input type="text" class="form-control" value="@(
                            Model.status == -3 ? "Aprobado" :
                            Model.status == 1 || Model.status == -2 ? "En proceso" :
                            Model.status == 4 ? "Rechazado" :
                            Model.status == 6 ? "N/A" : "N/A"
                        )">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label fw-bold">Prioridad</label>
                            <input type="text" class="form-control" value="@(
                            Model.Priority == 1 ? "Normal" :
                            Model.Priority == 0 ? "Bajo" : "Alta"
                        )">
                        </div>
                    </div>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Asignado a</label>
                            <input type="text" class="form-control" value="@Model.U_NAME">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label fw-bold">Solicitante</label>
                            <input type="text" class="form-control" value="@Model.U_Solicitante" id="contract">
                        </div>
                    </div>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Asunto</label>
                            <textarea class="form-control" rows="2">@Model.Details</textarea>
                        </div>
                    </div>

                    <div class="row mb-3 justify-content-center">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Correo(s) electrónico a notificar</label>
                            <textarea class="form-control" rows="5">@Model.U_Correo</textarea>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(ViewBag.source))
                    {
                        <h4 class="fw-bold">Firmas Registradas en Solicitud</h4>
                        
                        <div class="row mb-3 justify-content-center text-center">
                            <div class="col-md-2">
                                <img width="250" height="200" src="@ViewBag.source" style="border:1px solid"><br />
                                <strong class="d-block">Firma de Empleado:</strong>
                                <span>@Model.U_Solicitante</span>
                            </div>

                            @if (Model.status == -3)
                            {
                                <div class="col-md-2">
                                    <img width="250" height="200" src="@ViewBag.source_j" style="border:1px solid"><br />
                                    <strong class="d-block">Firma Jefe Inmediato:</strong>
                                    <span>@ViewBag.nombre_j</span>
                                </div>

                                <div class="col-md-2">
                                    <img width="250" height="200" src="@ViewBag.source_n" style="border:1px solid"><br />
                                    <strong class="d-block">Firma Nómina:</strong>
                                    <span>@ViewBag.nombre_n</span>
                                </div>
                            }
                        </div>
                    }
                </fieldset>

                <div class="center-buttons mt-2">
                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModalEstado">
                        Cambiar Estado
                    </button>

                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalLocalC">
                        Ingresar Comentarios
                    </button>

                    <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#exampleModalMail">
                        Modificar Correos a Notificar
                    </button>

                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModalCheck">
                        Descargar Solicitud
                    </button>
                </div>

            </div>
            </div>
        </div>
</div>